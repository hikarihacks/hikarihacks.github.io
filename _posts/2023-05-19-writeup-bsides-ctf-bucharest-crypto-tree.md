---
layout: post
title:  "Writeup for Bsides Bucharest 2023 Crypto Challenge : Tree"
tags: crypto ctf bsides 2023
---
We were given the following challenge file:
```txt
N1 = 8031618907246846293693568836815117208651063386187704278718166214344114978959730267514303804876950385073953809978184674199099111223241119973112414768733259429140823345281935701981385242857267487322827865072639201918083860766705532518958225072420208593562762274373077345732928513205398088392376267784000545850405791034708387531248432382382352146512034311302620155386423657953175713592725809349364514007903245317061948961942678445547870442460580832167929476816798746372950075822412434725709806440976719673937699409895972140948174650258975089830983555527002771726947541339526366698832271990428922771088544497289129058387
N2 = 8386670699170576480453736234757956361775037172524074602775175325265578443577347270422310059731760552786620111539963845182379824213402799983103060950085616201729181069697075804082708397315077802680924334550174880968123252267013708539194966124401623832459074689618181841322959450610172721644112726323551975384227542080233728081303735852735509683509720273168477553662485335512604183770759052991772264157368582908288481203945740119498662729623937782037932646924802357912266039226361613717961676351934101598489539427953384924157005783444504930561115077167723501460638741779588375982356486932126823682831368294630491458863
N3 = 164229444895339427823332915804307168736238505325340489143602488268446013471671925294820884501254796582100760544927043700120331149399315253355345292015297461801699949113666144767487857264925420996790346129650930838391684793886156851094194442369907758566630587332755634922794360782481436058966337028520062281227534627622673757900839420137347170608464893259306755412322918065825394908488711345121464962153640512144087196377022769680593364145232270054243502690405112259241776693397230832608605477777081707864240234903810960653234661229551256163623063472885287142694266840444174631635500177007501646843481638636908774841
e = 3
c1 = 6410705887951602785460889798494510087940970245171448111360871746444072726876106663576683957155496484645762997787614993134341334974344398485928647830768441773300092671832843618216361436380403832536126715578665722093125244128847890386026174898864643579748739198375349048611512655689397572922268624514870580221375071779655501505337296130781191254612648285866994070123896641956122717596448394998100900318432051693473930654640098387999897642500926772280266088075608645729278091136653859350145873156268518949185747152756186293748456788917191349607272592078301306702930580446272310295558368492798082059816502473707071573681
c2 = 1958923468840403210126038799352058266895179631037653084450645531568314352117182749802587705278167931124274930096166109299759139006013580732756380701618154537278073064925481470757023532547500287544412751705309551862604926961980624148266551283520442938178073860901061620488716655288268189743534726509608597498705431807086104982373965202075018357462281858434020372033693592245014031783530343685421516934135820049343912281374789238097996543545790474190486330568908914546041261302445282723846221076766603702860743079400368890078473721658854818094886910200715231301948864168808926753320885613698195208837764348498299676425
c3 = 56453248182037305206847972048139802851073110498252721750286246059008479863454478642488763437787139783695229722518608299755206344306405949492290571563466856113602790361332383864402268522710427150926263510584758356623763813414473170765805681326416105152156946597915055364037810460568575516355339000453443605012075041222881456079518147987664469471074202532992120386390391122273494761003279460997876469428926019107417634640278284999302716747019420049405091191000627039701491500477550345750801469287740893689259274358853168448833999561575732272724191407584469202741927874739913984523575131970195928850769222959652917210
```

The small value of __e__ instantly raises an alarm bell, as it clearly indicates that the attack has to exploit the small value of the __e__ variable somehow. Also, why do we have three different keys and ciphertexts?
After performing a little googling, we can find a Medium article that explains that this setup is a classic example of a Hastad's Broadcast attack.

Using the Chinese Remainder Theorem, we can find a value M=m^3, where m is the cleartext message, that solves the modular arithmetic system.
Due to the small value of e, we only need to compute the cube root of M in order to find the value of the cleartext message.

The solver script used:
```py
#!/usr/bin/env python3
from sympy.ntheory.modular import crt
from sympy.functions.elementary.miscellaneous import cbrt
from Crypto.Util.number import long_to_bytes

def parse_inputs(fname : str):
    with open(fname) as f:
        contents = f.readlines()
        ns = contents[:3]
        ns = list(map(lambda x : int(x.strip().split(" ")[-1]), ns))
        cs = contents[:3:-1][::-1]
        cs = list(map(lambda x : int(x.strip().split(" ")[-1]), cs))
        return ns, cs

if __name__=="__main__":
    N, c = parse_inputs('tree.txt')
    m = crt(N, c)[0]
    m = cbrt(m)
    print(long_to_bytes(m))
```

Thanks for reading and keep hacking :)
